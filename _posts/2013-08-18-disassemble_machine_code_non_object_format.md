---
layout: post
title:  "Disassembling machine code in non-object format"
date:   2013-08-18
author: Alexandre
categories: technical
---

A few weeks ago I wanted to check there were not too many aberrations in the
code generated by [rejit][rejit]. Since no disassembler is yet included in the
project, it had to be done manually.
The process is quite easy and can turn handy when needing to disassemble an
arbitrary dump.

Let's assume the machine code is dumped a file.
{% highlight bash %}
$ echo "__x0123" > code.dump
{% endhighlight %}

Multiple disassembler can be used for the task. Let's see how to use them for
very simple disassembly tasks.

### ndisasm

ndisasm is easy to use; disassembling is straight forward.
<br /> The `-b` flag allows to switch between different bit-width modes.

{% highlight bash %}
$ ndisasm -b 64 code.dump
    00000000  5F                pop rdi
    00000001  5F                pop rdi
    00000002  7830              js 0x34
    00000004  3132              xor [rdx],esi
    00000006  330A              xor ecx,[rdx]
{% endhighlight %}

ndisasm provides the very convenient `-k <offset>,<length>` option allowing to
skip disassembling some regions. This can be very useful to skip constant
pools in jitted code.

{% highlight bash %}
$ ndisasm -b 64 code.dump -k0x4,2
    00000000  5F                pop rdi
    00000001  5F                pop rdi
    00000002  7830              js 0x34
    00000004  skipping 0x2 bytes
    00000006  330A              xor ecx,[rdx]
{% endhighlight %}


Unluckily ndisasm only supports x86.


### objdump

That's where objdump shows handy: it is available for many architectures.
<br />Example outputs are given for x86-64 and ARM.

{% highlight bash %}
objdump --disassemble-all --target=binary --architecture=i8086 -Mx86-64 code.dump
    [...]
    0: 5f                    pop    %rdi
    1: 5f                    pop    %rdi
    2: 78 30                 js     0x34
    4: 31 32                 xor    %esi,(%rdx)
    6: 33 0a                 xor    (%rdx),%ecx
{% endhighlight %}

{% highlight bash %}
objdump --disassemble-all --target=binary --architecture=arm code.dump
    [...]
    0: 30785f5f  rsbscc  r5, r8, pc, asr pc
    4: 0a333231  beq 0xccc8d0
{% endhighlight %}

I haven't seen an obvious option to skip disassembling specific addresses.
If you find a way to do so please let me know!

[rejit]: /projects/rejit/
